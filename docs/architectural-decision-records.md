# Architectural Decision Records

## Static site deployment infrastructure
Context: 
- We need to host the Angular application somewhere.
- Because we’re so early in development, we should choose the easiest option that’s also reasonably priced.
- It could be nice to use the same service for the frontend and backend services. Maybe the same VM?

Options:
- NGINX docker container in a linux VM, in linode
    - Simple, quick, fully open source
    - More long-term maintenance, less secure
    - More predictable pricing
    - Same setup locally vs deployed
    - Ansible, Chef, Puppet
- AWS S3 + Cloudfront
    - More secure, production ready
    - Lock-in to AWS
    - Less predictable pricing, but generally cheap
    - Opentofu

Decision:
- Docker container in a linux VM for now, because of the consistency with local envs, but we will consider AWS in the future

## REST API deployment infrastructure

Context:
- We need to deploy a REST API, for basic CRUD operations like storing each user’s documents

Options:
- AWS Native, all in lambda functions
    - AWS Lock-in
    - Super scalable
    - More complex, especially if we’re not using AWS RDS for the db
    - Cannot run locally
    - Opentofu
- Supabase PostgREST. Don’t write our own APIs, rely on supabase’s autogenerated APIs from Postgres schemas
    - Quicker for the initial POC for sure
    - Lock in to Supabase, would be hard to get away from it later
    - May not support more complex logic. Non-crud features.
    - Cannot run locally
    - IaC? Unsure
- Docker container in a linux VM, in linode
    - Predictable pricing
    - Fully open-source, not as much lock in
    - Can run locally
    - Could reuse the VM that’s running the frontend
    - Not as scalable. Not as secure.
    - Ansible, Chef, Puppet

Decision:
- Docker container in a linux VM for now, because of the consistency with local envs, but we will consider AWS in the future

## Database

Context:
- We need a database, for storing the documents created by each user

Options:
- Supabase Postgres
    - Super generous free tier
    - Fully managed
    - Also comes with supabase auth, which would be nice
- AWS RDS
    - More expensive, can be hundreds of dollars
- SQLite in the VM
    - Basically free, but not as scalable
    - Would require FS backup so we don’t lost the whole DB

Decision:
- SQLite in VM, with hourly backups to S3 using a cronjob


## Observability Platform
Context:
- We need some service for tracking basic observability signals that are produced by our deployments
- Signals: logs, metrics, traces

Options:
- NewRelic 
  - Very generous free tier (100GB data)
  - Supports otel
  - Good UIs for all the observability we'd need in this app
  - 8 day retention
  - no limit on hosts

- Datadog
  - 1 day retention
  - 5 hosts

- Grafana Cloud
  - 14 day retention
  - 10k metrics
  - 50GB per signal